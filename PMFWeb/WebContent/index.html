<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Online Process Mining</title>
<style type="text/css">

.node {
  cursor: pointer;
  stroke: #3182bd;
  stroke-width: 1.5px;
}

.link {
  stroke: #000;
  stroke-width: 3px;
}

.nodetext {
  pointer-events: none;
  font: 12px;
  font-family:helvetica,arial;
}

.node.type0 {
        fill:#fff;
}
.node.type1 {
        fill:#fff;
}

</style>
<script type="text/javascript" src="jquery-2.1.0.js"></script>
<script type="text/javascript" src="d3.js"></script>
<script>
$(document).ready(function() {
	var json = {logid : 0};
	getResults(json);
});

function doAlpha() {
	var json = {logid : $("#logchoice").val()};
	getResults(json);
}

function getResults(json) {
	alert(json);
	$.ajax({
		url : "TestServlet",
		data : {
			"logJson" : json
			},
		type : "POST",
		dataType : "json",
		contentType: "application/x-www-form-urlencoded; charset=utf-8", 
		success : function(json) {
			// send back a json object
			if (json.status == "OK") {
				displayResults(json.result);
			}
 		},

		// code to run if the request fails;
		// the raw request and status codes are passed to the function
		error : function(xhr, status, errThrown) {
			alert("Sorry, there was a problem!");
			console.log("Error: " + errThrowm);
			console.log("Status: " + status);
			console.dir(xhr); 
		},

		// code to run regardless of success or failure
		complete :function(xhr, status) {
			//alert("The request is complete!");
		}
	}); 
}

function displayResults(root) {
	update(root);
}
</script>
</head>
<body>
<script>
var r = 30;
var s = 50;
var width = 960, height = 500;

var data = {
		"nodes":[{"label":"Start", "type":"PN_PLACE"}, 
		 		{"label":"A", "type":"PN_TRANSITION"},
		 		{"label":"End", "type":"PN_PLACE"}],
		"links":[{"source":0, "target":1, "type":1},
		         {"source":1, "target":2, "type":1}]
};

var force = d3.layout.force()
	.gravity(0)
	.linkDistance(100)
	.charge(-100)
	.size([width,height])
	.on("tick", tick);;

var svg = d3.select("body").append("svg")
	.attr("width", width)
    .attr("height", height);

svg.append("defs").append("marker")
	.attr("id", "arrowhead")
	.attr("refX", 17 + 3) /*must be smarter way to calculate shift*/
	.attr("refY", 2)
	.attr("markerWidth", 6)
	.attr("markerHeight", 4)
	.attr("orient", "auto")
	.append("path")
	.attr("d", "M 0,0 V 4 L6,2 Z"); //this is actual shape for arrowhead

var link = svg.selectAll(".link"), node = svg.selectAll(".node");

function update(root) {
	var nodes = root.nodes;
	var links = root.links;

	// Restart the force layout
	force.nodes(nodes)
		.links(links)
		.start();

	// Update the links…
	link = link.data(links);

	// Exit any old links.
	  link.exit().remove();

	  // Enter any new links.
	  link.enter().insert("line", ".node")
	      .attr("class", "link")
	      .attr("x1", function(d) { return d.source.x; })
	      .attr("y1", function(d) { return d.source.y; })
	      .attr("x2", function(d) { return d.target.x; })
	      .attr("y2", function(d) { return d.target.y; })
	      .attr("marker-end", function (d) {
    		if (d.type == 1) {
        		return "url(#arrowhead)"
    		} else {
        		return " "
    	   	};
	      });

	  // Update the nodes…
	  node = node.data(nodes);

	  // Exit any old nodes.
	  node.exit().remove();

	  node.enter().append("svg:g")
	  	.attr("class", function(d){
			if (d.type == "PN_TRANSITION") {
				return "transition node";
			} else {
				return "circle node";
			}
	     })
		 .call(force.drag);

	  d3.selectAll(".transition").append("rect")
	  	.attr("x", function(d) { return -s/2; })
    	.attr("y", function(d) { return -s/2; })
    	.attr("width", s)
    	.attr("height", s)
    	.attr("class", "node type"+0);

	  d3.selectAll(".circle").append("circle")
	  	.attr("r", r)
  		.attr("class", "node type"+1);

	  node.append("svg:text")
	    .attr("class", "nodetext")
	    .attr("dx", 0)
	    .attr("dy", ".50em")
	    .attr("text-anchor", "middle")
	    .text(function (d) {
	    return d.label;
		});

	 //标记鼠标悬停的标签
	 node.append("title")
		  .text(function(d) { return d.label; });
}

function tick() {
	  link.attr("x1", function(d) { return d.source.x; })
	      .attr("y1", function(d) { return d.source.y; })
	      .attr("x2", function(d) { return d.target.x; })
	      .attr("y2", function(d) { return d.target.y; });

	  node.attr("transform", function (d) {
	      return "translate(" + d.x + "," + d.y + ")";
	  });
}
</script>
Choose a log file:<br>
<select id="logchoice">
	<option value="0" selected>FILE I</option>
	<option value="1" selected>FILE II</option>
	<option value="2" selected>FILE III</option>
	<option value="3" selected>FILE IV</option>
	<option value="4" selected>FILE V</option>
</select>
<input type="button" name="Submit" value="Choose" onClick="doAlpha()" />
</body>
</html>